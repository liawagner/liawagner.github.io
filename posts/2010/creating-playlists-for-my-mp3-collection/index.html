<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Random Thoughts and Geekery by Ant Zucaro</title>
    <link rel="stylesheet" href="/static/css/blog.min.css" />

  </head>

  <body>
    <div class="container">
  <div class="row">
    <div class="two columns">&nbsp;</div>
    <div class="eight columns top-nav">
      <ul class="nav">
        <li><a class="logo" href="/">Ant Zucaro</a></li>
        <li><a href="/categories/photography">photography</a></li>
        <li><a href="/posts">archive</a></li>
        <li><a href="/about">about me</a></li>
        <li><a href="/index.xml">rss</a></li>
      </ul>
    </div>
  </div>
</div>



  <div class="container">
    <div class="row">
      <div class="two columns">&nbsp;</div>
      <div class="eight columns">
        <h2>Creating Playlists for my MP3 Collection</h2>
        <p class="post-date">November 7, 2010</p>

        <p>As I&rsquo;ve mentioned <a href="/2010/11/abcde-a-better-cd-encoder/">before</a>, about two summers back I went through my whole CD collection and digitized it to MP3 format using a tool called ABCDE. What I didn&rsquo;t mention in that post was that at the time I&rsquo;d forgotten to create playlists automatically during the process. Bummer! I had all of these albums digitized, but whenever I wanted to play a particular album I&rsquo;d have to add the folder through my music player or manually select all of the files to add to my playlist. That wasn&rsquo;t too bad, but if you&rsquo;ve had any experience with playlists in Windows Media Player, VLC, or even XMMS you&rsquo;ll know that in practice it is just a pain to handle. For whatever reason it may be, the ordering of the album tracks on the playlist <em><strong>always</strong></em> gets messed up when adding manually or via folders. <em><strong>Always!</strong></em> Now, I know I can fix this simply by sorting by the ID3 metadata (click the &ldquo;track number&rdquo; column in most players to sort), but the point is that <em>I shouldn&rsquo;t have to do this</em>. I wanted a simple solution.</p>

<p>I get annoyed with these things pretty quickly, so I started thinking about how I could remedy the situation to save myself some time. Obviously I could investigate <em>why </em>each of the players were failing to sort my properly named (and usually tagged) files, but that seemed like too much work. I thought a simple solution would be to create M3U (a <a href="http://www.google.com/url?sa=t&amp;source=web&amp;cd=1&amp;ved=0CBwQFjAA&amp;url=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FM3U&amp;rct=j&amp;q=m3u&amp;ei=sMnWTOWRFMP-8AaXnPmZBg&amp;usg=AFQjCNHVxaaNTKNnCiADQmd33edsMs0o4A&amp;sig2=OU39DvcsU8FPv3XmFXfiiQ&amp;cad=rja">standard</a> playlist format) playlist files in each album directory that would contain the exact track ordering of that particular album. That way to play an album all I&rsquo;d need to do was double click on the playlist file and <em>voila!</em> it would play it in the right order. This would also give me the ability to drag and drop multiple albums without having to worry about sort issues with having multiple track 1s (not too much of a problem with today&rsquo;s players, but still).</p>

<p>I did a little research and found a tool to help me write the playlists. It&rsquo;s a Python library called <a href="http://www.google.com/url?sa=t&amp;source=web&amp;cd=1&amp;ved=0CBkQFjAA&amp;url=http%3A%2F%2Fcode.google.com%2Fp%2Fmutagen%2F&amp;rct=j&amp;q=mutagen&amp;ei=FsvWTPb9IoT48AblrMjYDA&amp;usg=AFQjCNHzts_jR6qh9C_NtJi1COJQEfqHWQ&amp;sig2=eoawYstMNOwkQafn61uG1g&amp;cad=rja">mutagen</a>, and it basically allowed me to programmatically read the metadata of Mp3 files to get the following information (among the many other things it can retrieve):
<ul>
    <li>Track number</li>
    <li>Artist name</li>
    <li>Album name</li>
    <li>Track length (seconds)</li>
</ul>
After installing mutagen, I wrote the following Python script (m3u.py) to traverse through a set of directories and create playlist files at the lowest level. For example, if I ran it on <em>/home/ant/Music/Coldplay/Parachutes</em> I would end up with a playlist file inside the <em>Parachutes</em> directory:</p>

<p>[python]
#!/usr/bin/python</p>

<p>import os
import sys
import glob
from mutagen.mp3 import MP3
from mutagen.easyid3 import EasyID3</p>

<p>def makem3u(dir=&quot;.&quot;):
    try:
        print &quot;Processing directory &lsquo;%s&rsquo;.&quot; % dir
        os.chdir(dir)</p>

<pre><code>    # get ID3 meta objects for each mp3,
    # store in a list
    playlist = ''
    mp3s = []
    for file in glob.glob(&amp;quot;*.[mM][pP]3&amp;quot;):
        if playlist == '':
            playlist = EasyID3(file)['album'][0] + '.m3u'
        meta_info = {
            'filename': file,
            'length': int(MP3(file).info.length),
            'tracknumber': EasyID3(file)['tracknumber'][0].split('/')[0],
        }
        mp3s.append(meta_info)

    if len(mp3s) &amp;gt; 0:
        print &amp;quot;Writing playlist %s.&amp;quot; % playlist

        # write the playlist
        of = open(playlist, 'w')
        of.write(&amp;quot;#EXTM3U\n&amp;quot;)

        # sorted by track number
        for mp3 in sorted(mp3s, key=lambda mp3: int(mp3['tracknumber'])):
            of.write(&amp;quot;#EXTINF:%s,%s\n&amp;quot; % (mp3['length'], mp3['filename']))
            of.write(mp3['filename'] + &amp;quot;\n&amp;quot;)

        of.close()

except:
    print &amp;quot;Error when trying to process directory '%s'. Ignoring...&amp;quot; % dir
    print &amp;quot;Text:&amp;quot;, sys.exc_info()[0]
</code></pre>

<p>def main(argv = None):
    if argv is None:
        argv = sys.argv</p>

<pre><code># directories containing music files
dirs = []

if len(sys.argv) == 2 and sys.argv[1] == '-':
# we do not have command line arguments,
# so read from STDIN
   for line in sys.stdin:
       dirs.append(line.strip())
else:
# passed in directories on the command line
    for dir in sys.argv[1:]:
        dirs.append(dir)

# for each directory passed to us, go
# to it and make the M3U out of the
# MP3 files there
for dir in dirs:
    makem3u(dir)

return 0
</code></pre>

<p>if <strong>name</strong> == &quot;<strong>main</strong>&quot;:
    sys.exit(main())
[/python]</p>

<p>You can pass directories two ways this script - as arguments or via standard input. This allows me to do this:</p>

<pre class="brush:bash;">m3u.py /home/ant/Music/Coldplay/Parachutes</pre>

<p>&hellip;or if I wanted to do a bunch of directories in bulk:</p>

<pre class="brush:bash;">find /home/ant/Music -type d -links 2 | m3u.py - </pre>

<p>Note that I made only a small attempt to make this script bulletproof. It gives a decent attempt to find the metadata in the MP3 files it finds in the directory, but if it encounters an error thrown by mutagen it dies out with an error message telling me the directory that failed and the exception it hit. Nine times out of ten (in my testing) the script will die because the tag information in the MP3s are malformed, which means that you wouldn&rsquo;t want to create a playlist off of them using that info anyway.</p>


        <section id="prev">
          Previous post: <a class="previous" href="https://chriswayg.github.io/posts/2010/xonotic-player-interview-divverent/"><i class="icon-arrow-left"></i> &#39;Xonotic Player Interview: divVerent&#39;</a><br>
        </section>

        <section id="next">
          Next post: <a class="next" href="https://chriswayg.github.io/posts/2010/gettysburg-january-2008/">Gettysburg - January 2008 <i class="icon-arrow-right"></i></a>
        </section>
      </div>
      <div class="two columns">&nbsp;</div>
    </div>
  </div>

    
    <div id="footer">
      <div class="row" >
        <div class="twelve columns">
          <p>&copy; Ant Zucaro 2009-2016. &nbsp; Powered by <a href="http://hugo.spf13.com" title="The Hugo static site generator">Hugo</a>.</p>
        </div>
      </div>
    </div>

    <script src="/static/js/vendor/jquery.js"></script>
<script src="/static/js/vendor/jquery.unveil.min.js"></script>
<script>
  $(document).ready(function() {
    $("img").unveil();
  });
</script>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1465952-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>

  </body>
</html>

